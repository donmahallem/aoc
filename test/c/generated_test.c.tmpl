// Code generated by testgen. DO NOT EDIT.

// Fallback for build systems that set TEST_DATA_DIR at compile time.
#ifndef TEST_DATA_DIR
#define TEST_DATA_DIR ""
#endif

#include <assert.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "{{.HeaderPath}}"

{{- range .InlineSamples}}
static const char {{.VarName}}[] = {{cEscapeString .Input}};
{{- end}}

{{- if .Part1}}
{{- range .Part1.Samples}}
static void test_{{$.PaddedDay}}_part1_{{.Name}}(void)
{
    FILE* in = tmpfile();
    aoc_result_t result;
    aoc_error_t err;

    assert(in != NULL);

    /* inline sample input */
    fputs({{.VarName}}, in);
    rewind(in);
    err = aoc24_day{{$.PaddedDay}}_part1(in, &result);
    assert(err == AOC_OK);

    {{- if .IsArray}}
    /* expected array initializer ({{.ValueKind}}) */
    {{- if eq .ValueKind "i64_array" }}
    const int64_t expected[] = {{.Expected}};
    {{- else if eq .ValueKind "i16_array" }}
    const int16_t expected[] = {{.Expected}};
    {{- else if eq .ValueKind "cstr_array" }}
    const char *expected[] = {{.Expected}};
    {{- end}}
    const size_t expected_len = sizeof(expected) / sizeof(expected[0]);

    {{- if eq .ValueKind "i64_array" }}
    assert(result.kind == AOC_RESULT_I64_ARRAY);
    assert(result.value.i64_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(result.value.i64_array.items[i] == expected[i]);
    }
    {{- else if eq .ValueKind "i16_array" }}
    assert(result.kind == AOC_RESULT_I16_ARRAY);
    assert(result.value.i16_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(result.value.i16_array.items[i] == expected[i]);
    }
    {{- else if eq .ValueKind "cstr_array" }}
    assert(result.kind == AOC_RESULT_CSTR_ARRAY);
    assert(result.value.cstr_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(strcmp(result.value.cstr_array.items[i], expected[i]) == 0);
    }
    {{- end}}

    {{- else}}
    /* scalar expected ({{.ValueKind}}) */
    {{- if eq .ValueKind "cstr" }}
    assert(result.kind == AOC_RESULT_CSTR);
    assert(strcmp(result.value.cstr, {{.Expected}}) == 0);
    {{- else}}
    assert(result.kind == AOC_RESULT_I64);
    assert(result.value.i64 == {{.Expected}});
    {{- end}}
    {{- end}}

    fclose(in);
}
{{- end}}

{{- range .Part1.Files}}
static void test_{{$.PaddedDay}}_part1_{{.Name}}(void)
{
    const char* path = TEST_DATA_DIR "/{{.FilePath}}";
    FILE* f = fopen(path, "r");
    if (!f) { printf("missing %s\n", path); return; }

    aoc_result_t result;
    aoc_error_t err = aoc24_day{{$.PaddedDay}}_part1(f, &result);
    fclose(f);
    assert(err == AOC_OK);

    {{- if .IsArray}}
    {{- if eq .ValueKind "i64_array" }}
    const int64_t expected[] = {{.Expected}};
    {{- else if eq .ValueKind "i16_array" }}
    const int16_t expected[] = {{.Expected}};
    {{- else if eq .ValueKind "cstr_array" }}
    const char *expected[] = {{.Expected}};
    {{- end}}
    const size_t expected_len = sizeof(expected) / sizeof(expected[0]);

    {{- if eq .ValueKind "i64_array" }}
    assert(result.kind == AOC_RESULT_I64_ARRAY);
    assert(result.value.i64_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(result.value.i64_array.items[i] == expected[i]);
    }
    {{- else if eq .ValueKind "i16_array" }}
    assert(result.kind == AOC_RESULT_I16_ARRAY);
    assert(result.value.i16_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(result.value.i16_array.items[i] == expected[i]);
    }
    {{- else if eq .ValueKind "cstr_array" }}
    assert(result.kind == AOC_RESULT_CSTR_ARRAY);
    assert(result.value.cstr_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(strcmp(result.value.cstr_array.items[i], expected[i]) == 0);
    }
    {{- end}}

    {{- else}}
    {{- if eq .ValueKind "cstr" }}
    assert(result.kind == AOC_RESULT_CSTR);
    assert(strcmp(result.value.cstr, {{.Expected}}) == 0);
    {{- else}}
    assert(result.kind == AOC_RESULT_I64);
    assert(result.value.i64 == {{.Expected}});
    {{- end}}
    {{- end}}
}
{{- end}}
{{- end}}

{{- if .Part2}}
{{- range .Part2.Samples}}
static void test_{{$.PaddedDay}}_part2_{{.Name}}(void)
{
    FILE* in = tmpfile();
    aoc_result_t result;
    aoc_error_t err;

    assert(in != NULL);

    /* inline sample input */
    fputs({{.VarName}}, in);
    rewind(in);
    err = aoc24_day{{$.PaddedDay}}_part2(in, &result);
    assert(err == AOC_OK);

    {{- if .IsArray}}
    /* expected array initializer ({{.ValueKind}}) */
    {{- if eq .ValueKind "i64_array" }}
    const int64_t expected[] = {{.Expected}};
    {{- else if eq .ValueKind "i16_array" }}
    const int16_t expected[] = {{.Expected}};
    {{- else if eq .ValueKind "cstr_array" }}
    const char *expected[] = {{.Expected}};
    {{- end}}
    const size_t expected_len = sizeof(expected) / sizeof(expected[0]);

    {{- if eq .ValueKind "i64_array" }}
    assert(result.kind == AOC_RESULT_I64_ARRAY);
    assert(result.value.i64_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(result.value.i64_array.items[i] == expected[i]);
    }
    {{- else if eq .ValueKind "i16_array" }}
    assert(result.kind == AOC_RESULT_I16_ARRAY);
    assert(result.value.i16_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(result.value.i16_array.items[i] == expected[i]);
    }
    {{- else if eq .ValueKind "cstr_array" }}
    assert(result.kind == AOC_RESULT_CSTR_ARRAY);
    assert(result.value.cstr_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(strcmp(result.value.cstr_array.items[i], expected[i]) == 0);
    }
    {{- end}}

    {{- else}}
    /* scalar expected ({{.ValueKind}}) */
    {{- if eq .ValueKind "cstr" }}
    assert(result.kind == AOC_RESULT_CSTR);
    assert(strcmp(result.value.cstr, {{.Expected}}) == 0);
    {{- else}}
    assert(result.kind == AOC_RESULT_I64);
    assert(result.value.i64 == {{.Expected}});
    {{- end}}
    {{- end}}

    fclose(in);
}
{{- end}}

{{- range .Part2.Files}}
static void test_{{$.PaddedDay}}_part2_{{.Name}}(void)
{
    const char* path = TEST_DATA_DIR "/{{.FilePath}}";
    FILE* f = fopen(path, "r");
    if (!f) { printf("missing %s\n", path); return; }

    aoc_result_t result;
    aoc_error_t err = aoc24_day{{$.PaddedDay}}_part2(f, &result);
    fclose(f);
    assert(err == AOC_OK);

    {{- if .IsArray}}
    {{- if eq .ValueKind "i64_array" }}
    const int64_t expected[] = {{.Expected}};
    {{- else if eq .ValueKind "i16_array" }}
    const int16_t expected[] = {{.Expected}};
    {{- else if eq .ValueKind "cstr_array" }}
    const char *expected[] = {{.Expected}};
    {{- end}}
    const size_t expected_len = sizeof(expected) / sizeof(expected[0]);

    {{- if eq .ValueKind "i64_array" }}
    assert(result.kind == AOC_RESULT_I64_ARRAY);
    assert(result.value.i64_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(result.value.i64_array.items[i] == expected[i]);
    }
    {{- else if eq .ValueKind "i16_array" }}
    assert(result.kind == AOC_RESULT_I16_ARRAY);
    assert(result.value.i16_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(result.value.i16_array.items[i] == expected[i]);
    }
    {{- else if eq .ValueKind "cstr_array" }}
    assert(result.kind == AOC_RESULT_CSTR_ARRAY);
    assert(result.value.cstr_array.length == expected_len);
    for (size_t i = 0; i < expected_len; ++i) {
        assert(strcmp(result.value.cstr_array.items[i], expected[i]) == 0);
    }
    {{- end}}

    {{- else}}
    {{- if eq .ValueKind "cstr" }}
    assert(result.kind == AOC_RESULT_CSTR);
    assert(strcmp(result.value.cstr, {{.Expected}}) == 0);
    {{- else}}
    assert(result.kind == AOC_RESULT_I64);
    assert(result.value.i64 == {{.Expected}});
    {{- end}}
    {{- end}}
}
{{- end}}

{{- end}}

int main(void)
{
{{- if .Part1}}
{{- range .Part1.Samples}}
    test_{{$.PaddedDay}}_part1_{{.Name}}();
{{- end}}
{{- range .Part1.Files}}
    test_{{$.PaddedDay}}_part1_{{.Name}}();
{{- end}}
{{- end}}
{{- if .Part2}}
{{- range .Part2.Samples}}
    test_{{$.PaddedDay}}_part2_{{.Name}}();
{{- end}}
{{- range .Part2.Files}}
    test_{{$.PaddedDay}}_part2_{{.Name}}();
{{- end}}
{{- end}}
    return 0;
}
